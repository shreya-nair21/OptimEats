<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Business Dashboard — OptimEats</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}" />
</head>
<body>
    <div class="container">
        <header>
            <h1>Business Dashboard</h1>
            <div class="balance card" aria-live="polite">
                <div style="font-size:12px; color:#6b7280;">Current balance</div>
                <!-- Replace {{ balance }} with your server-side value -->
                <div id="balance" style="font-weight:600; font-size:18px;">{{ balance }}</div>
            </div>
        </header>

        <div class="grid">
            <!-- Left: Meal items table -->
            <section class="card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong>Your meal items</strong>
                    <span class="muted">Total: <!-- replace with count --> {{ meals|length }}</span>
                </div>

                <table class="meals-list" aria-describedby="meals-desc">
                    <thead>
                        <tr>
                            <th>Preview</th>
                            <th>Item</th>
                            <th>Price</th>
                            <th>Availability</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="meals-body">
                        <!-- Replace this loop with your server-side templating (example below uses Jinja/Django-like syntax) -->
                        {% for meal in meals %}
                        <tr>
                            <td><img class="thumb" src="{{ meal.image_url }}" alt="{{ meal.name }}" /></td>
                            <td>
                                <div style="font-weight:600;">{{ meal.name }}</div>
                                <div class="muted">{{ meal.description }}</div>
                            </td>
                            <td>${{ "%.2f"|format(meal.price) }}</td>
                            <td class="muted">{{ meal.available|yesno:"Available,Unavailable" }}</td>
                            <td style="text-align:right;">
                                <form method="post" action="/meals/{{ meal.id }}/toggle" style="display:inline;">
                                    <!-- csrf token if needed -->
                                    <button class="secondary" type="submit">{{ meal.available|yesno:"Disable,Enable" }}</button>
                                </form>
                                <form method="post" action="/meals/{{ meal.id }}/delete" style="display:inline;" onsubmit="return confirm('Delete this item?')">
                                    <button class="secondary" type="submit">Delete</button>
                                </form>
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="5" class="empty">No meal items yet. Add your first meal on the right.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </section>

            <!-- Right: Add new meal -->
            <aside class="card">
                <strong>Add a meal</strong>
                <form id="add-meal-form" method="post" action="/meals/add" enctype="multipart/form-data">
                    <!-- Insert CSRF token here if required by your framework -->
                    <label for="name">Name</label>
                    <input id="name" name="name" type="text" required maxlength="100" />

                    <label for="description">Description</label>
                    <textarea id="description" name="description" maxlength="500"></textarea>

                    <label for="price">Price (USD)</label>
                    <input id="price" name="price" type="number" step="0.01" min="0" required />

                    <label for="category">Category</label>
                    <select id="category" name="category">
                        <option value="">— Select —</option>
                        <option>Breakfast</option>
                        <option>Lunch</option>
                        <option>Dinner</option>
                        <option>Dessert</option>
                        <option>Beverage</option>
                    </select>

                    <label for="available">
                        <input id="available" name="available" type="checkbox" checked /> Available for order
                    </label>

                    <label for="image">Image</label>
                    <input id="image" name="image" type="file" accept="image/*" />
                    <img id="image-preview" class="preview" alt="Image preview" style="display:none;" />

                    <div class="actions">
                        <button type="submit">Add meal</button>
                        <button type="button" class="secondary" id="reset-btn">Reset</button>
                    </div>
                </form>
            </aside>
        </div>
    </div>

    <script>
        // Image preview
        (function(){
            const imageInput = document.getElementById('image');
            const preview = document.getElementById('image-preview');
            const resetBtn = document.getElementById('reset-btn');
            const form = document.getElementById('add-meal-form');

            imageInput.addEventListener('change', function(){
                const file = this.files && this.files[0];
                if (!file) {
                    preview.style.display = 'none';
                    preview.src = '';
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e){ preview.src = e.target.result; preview.style.display = 'block'; };
                reader.readAsDataURL(file);
            });

            resetBtn.addEventListener('click', function(){
                form.reset();
                preview.style.display = 'none';
                preview.src = '';
            });

            // Basic client-side price validation
            form.addEventListener('submit', function(e){
                const price = parseFloat(document.getElementById('price').value);
                if (isNaN(price) || price < 0) {
                    e.preventDefault();
                    alert('Please enter a valid non-negative price.');
                }
            });
        })();
    </script>
</body>
</html>